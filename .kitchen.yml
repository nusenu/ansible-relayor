---
driver:
  name: vagrant
  customize:
    memory: 512

platforms:
  - name: debian-11
  - name: ubuntu-22.04
  - name: freebsd-13
    driver:
      provision: True
      vagrantfiles:
        - test/vagrant_provisions/freebsd_vagrant_provision.rb
  - name: centos9s
    driver:
      box: roboxes/centos9s
  - name: rhel9
    driver:
      box: generic/rhel9
  - name: fedora37
    driver:
      box: roboxes/fedora37
  - name: freebsd-12
    driver:
      box: roboxes/freebsd12
      provision: True
      vagrantfiles:
        - test/vagrant_provisions/freebsd_vagrant_provision.rb
  - name: openbsd7
    driver:
      box: roboxes/openbsd7
      provision: True
      vagrantfiles:
        - test/vagrant_provisions/openbsd_vagrant_provision.rb

provisioner:
  name: ansible_push
  chef_bootstrap_url: nil
  idempotency_test: true
  fail_non_idempotent: true
  diff: true

transport:
  max_ssh_sessions: 6

suites:
  - name: t-guard
    provisioner:
      playbook: "test/integration/default/guard-node.yml"
  - name: t-exit
    provisioner:
      playbook: "test/integration/default/exit-node.yml"
  - name: t-guard-alpha
    provisioner:
      playbook: "test/integration/default/guard-alpha-node.yml"
    excludes:
      - freebsd-13
      - freebsd-12
      - openbsd7
  - name: t-guard-nightly
    provisioner:
      playbook: "test/integration/default/guard-nightly-node.yml"
    excludes:
      - freebsd-13
      - freebsd-12
      - openbsd7
  - name: t-guard-metricsport-blackbox-exporter
    provisioner:
      playbook: "test/integration/default/guard-metricsport-blackbox.yml"
  - name: t-guard-alpha-metricsport-blackbox-exporter
    provisioner:
      playbook: "test/integration/default/guard-alpha-metricsport-blackbox.yml"
    excludes:
      - freebsd-13
      - freebsd-12
      - openbsd7
  - name: t-guard-nightly-metricsport-blackbox-exporter
    provisioner:
      playbook: "test/integration/default/guard-nightly-metricsport-blackbox.yml"
    excludes:
      - freebsd-13
      - freebsd-12
      - openbsd7
  - name: t-guard-blackbox-exporter
    provisioner:
      playbook: "test/integration/default/guard-blackbox-exporter.yml"
# test for the tor_ExitRelaySetting_file feature to run
# exit and non-exit tor instances on a single machine
  - name: t-mixed
    provisioner:
      playbook: "test/integration/default/mixed-node.yml"
  - name: t-exit-per-instance-exitpolicy
    provisioner:
      playbook: "test/integration/default/exit-per-instance-exitpolicy.yml"
  - name: t-guard-2publicIPs-metricsport
    driver:
      network:
      - ["private_network", {ip: "192.0.2.10"}]
      - ["private_network", {ip: "198.51.100.10"}]
    provisioner:
      playbook: "test/integration/default/2publicIPs-guard-metricsport.yml"
  - name: t-guard-2publicIPs
    driver:
      network:
      - ["private_network", {ip: "192.0.2.10"}]
      - ["private_network", {ip: "198.51.100.10"}]
    provisioner:
      playbook: "test/integration/default/2publicIPs-guard-node.yml"
  - name: t-exit-2publicIPs
    driver:
      network:
      - ["private_network", {ip: "192.0.2.10"}]
      - ["private_network", {ip: "198.51.100.10"}]
    provisioner:
      playbook: "test/integration/default/2publicIPs-exit-node.yml"
  - name: t-exit-6publicIPs-dedicatedExitIP-2instPerIP
    driver:
      network:
      - ["private_network", {ip: "192.0.2.10"}]
      - ["private_network", {ip: "198.51.100.10"}]
      - ["private_network", {ip: "198.51.100.11"}]
      - ["private_network", {ip: "198.51.100.12"}]
      - ["private_network", {ip: "198.51.100.13"}]
      - ["private_network", {ip: "198.51.100.14"}]
    provisioner:
      playbook: "test/integration/default/6publicIPs-dedicatedExitIP-2instPerIP-exit-node.yml"
  - name: t-exit-dirport0-6IPs-dedicatedExitIP-2PerIP
    driver:
      network:
      - ["private_network", {ip: "192.0.2.10"}]
      - ["private_network", {ip: "198.51.100.10"}]
      - ["private_network", {ip: "198.51.100.11"}]
      - ["private_network", {ip: "198.51.100.12"}]
      - ["private_network", {ip: "198.51.100.13"}]
      - ["private_network", {ip: "198.51.100.14"}]
    provisioner:
      playbook: "test/integration/default/dirport0-6publicIPs-dedicatedExitIP-2instPerIP-exit-node.yml"
  - name: t-exit-6publicIPs-dedicatedExitIP-singleInstPerIP
    driver:
      network:
      - ["private_network", {ip: "192.0.2.10"}]
      - ["private_network", {ip: "198.51.100.10"}]
      - ["private_network", {ip: "198.51.100.11"}]
      - ["private_network", {ip: "198.51.100.12"}]
      - ["private_network", {ip: "198.51.100.13"}]
      - ["private_network", {ip: "198.51.100.14"}]
    provisioner:
      playbook: "test/integration/default/6publicIPs-dedicatedExitIP-singleInstPerIP-exit-node.yml"
